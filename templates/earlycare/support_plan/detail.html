{% extends 'base.html' %}
{% load static %}

{% block title %}Support Plan Detail - ECSES{% endblock %}

{% block content %}
<div class="row mb-3">
    <div class="col-12 d-flex justify-content-between align-items-center">
        <h1><i class="fas fa-hands-helping me-2"></i>Support Plan</h1>
        <div class="d-flex gap-2">
            {% if can_edit %}
            <a href="{% url 'earlycare:support_plan_edit' support_plan.id %}" class="btn btn-outline-secondary"><i class="fas fa-edit me-1"></i>Edit</a>
            {% endif %}
            {% if user.is_superuser or (user.userprofile.role == 'admin') %}
            <a href="{% url 'earlycare:support_plan_delete' support_plan.id %}" class="btn btn-outline-danger"><i class="fas fa-trash me-1"></i>Delete</a>
            {% endif %}
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card mb-4">
            <div class="card-header">
                <strong>{{ child.first_name }} {{ child.last_name }}</strong>
                <span class="badge bg-secondary ms-2 text-capitalize">{{ support_plan.status }}</span>
            </div>
            <div class="card-body">
                <p class="mb-3"><strong>Goals</strong><br>{{ support_plan.goals|linebreaks }}</p>
                <p class="mb-3"><strong>Strategies</strong><br>{{ support_plan.strategies|linebreaks }}</p>
                {% if support_plan.resources_needed %}<p class="mb-3"><strong>Resources Needed</strong><br>{{ support_plan.resources_needed|linebreaks }}</p>{% endif %}
                {% if support_plan.timeline %}<p class="mb-3"><strong>Timeline</strong><br>{{ support_plan.timeline }}</p>{% endif %}
                {% if support_plan.progress_notes %}<p class="mb-0"><strong>Progress Notes</strong><br>{{ support_plan.progress_notes|linebreaks }}</p>{% endif %}
            </div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="card mb-4">
            <div class="card-header">Review</div>
            <div class="card-body">
                {% if support_plan.review_date %}<p class="mb-1"><strong>Review Date:</strong> {{ support_plan.review_date }}</p>{% endif %}
                {% if support_plan.next_review %}<p class="mb-1"><strong>Next Review:</strong> {{ support_plan.next_review }}</p>{% endif %}
            </div>
        </div>
        <div class="card">
            <div class="card-header">Child</div>
            <div class="card-body">
                <p class="mb-1"><strong>Name:</strong> {{ child.first_name }} {{ child.last_name }}</p>
                <p class="mb-1"><strong>Parent:</strong> {{ child.parent.get_full_name|default:child.parent.username }}</p>
                {% if child.teacher %}<p class="mb-1"><strong>Teacher:</strong> {{ child.teacher.get_full_name|default:child.teacher.username }}</p>{% endif %}
            </div>
        </div>
        {% if user.userprofile and user.userprofile.role == 'parent' %}
        <div class="alert alert-info" role="alert">
            <i class="fas fa-info-circle me-2"></i>
            This plan is read-only for parents. Please reach out to the teacher for changes.
        </div>
        <div class="d-grid mb-4">
            <button type="button" class="btn btn-outline-secondary btn-sm" disabled title="Acknowledgement tracking can be enabled by an admin.">
                <i class="fas fa-check me-1"></i>Mark as Acknowledged
            </button>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}


