{% extends 'base.html' %}
{% load static %}

{% block title %}Assessment Detail - ECSES{% endblock %}

{% block content %}
<div class="row mb-3">
    <div class="col-12 d-flex justify-content-between align-items-center">
        <h1><i class="fas fa-clipboard-check me-2"></i>Assessment Detail</h1>
        <div class="d-flex gap-2">
            {% if can_edit %}
            <a href="{% url 'earlycare:assessment_edit' assessment.id %}" class="btn btn-outline-secondary"><i class="fas fa-edit me-1"></i>Edit</a>
            {% endif %}
            {% if can_delete %}
            <a href="{% url 'earlycare:assessment_delete' assessment.id %}" class="btn btn-outline-danger"><i class="fas fa-trash me-1"></i>Delete</a>
            {% endif %}
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card mb-4">
            <div class="card-header">
                <strong>{{ child.first_name }} {{ child.last_name }}</strong>
            </div>
            <div class="card-body">
                <p class="mb-2"><strong>Type:</strong> {{ assessment.get_assessment_type_display }}</p>
                <p class="mb-2"><strong>Date:</strong> {{ assessment.assessment_date }}</p>
                <p class="mb-2"><strong>Status:</strong> <span class="badge bg-{% if assessment.status == 'completed' %}success{% elif assessment.status == 'in_progress' %}info{% elif assessment.status == 'assigned' %}primary{% elif assessment.status == 'draft' %}secondary{% else %}dark{% endif %}">{{ assessment.status|title|replace:"_"," " }}</span></p>
                {% if assessment.due_date %}<p class="mb-2"><strong>Due:</strong> {{ assessment.due_date }}</p>{% endif %}
                {% if assessment.overall_score %}
                <div class="mb-3">
                    <div class="progress" style="height: 10px;">
                        <div class="progress-bar bg-success" style="width: {% widthratio assessment.overall_score 5 100 %}%"></div>
                    </div>
                    <small class="text-muted">Overall: {{ assessment.overall_score|floatformat:1 }}/5.0</small>
                </div>
                {% endif %}

                <div class="row g-3">
                    {% if assessment.motor_score %}<div class="col-md-6"><strong>Motor:</strong> {{ assessment.motor_score }}</div>{% endif %}
                    {% if assessment.cognitive_score %}<div class="col-md-6"><strong>Cognitive:</strong> {{ assessment.cognitive_score }}</div>{% endif %}
                    {% if assessment.language_score %}<div class="col-md-6"><strong>Language:</strong> {{ assessment.language_score }}</div>{% endif %}
                    {% if assessment.social_score %}<div class="col-md-6"><strong>Social-Emotional:</strong> {{ assessment.social_score }}</div>{% endif %}
                    {% if assessment.adaptive_score %}<div class="col-md-6"><strong>Adaptive:</strong> {{ assessment.adaptive_score }}</div>{% endif %}
                </div>

                {% if assessment.notes %}
                <hr>
                <p><strong>Notes:</strong><br>{{ assessment.notes|linebreaks }}</p>
                {% endif %}
                {% if assessment.recommendations %}
                <p><strong>Recommendations:</strong><br>{{ assessment.recommendations|linebreaks }}</p>
                {% endif %}
            </div>
        </div>

        {% if user.userprofile and user.userprofile.role == 'parent' %}
        <div class="alert alert-info d-flex align-items-center" role="alert">
            <i class="fas fa-info-circle me-2"></i>
            You are viewing this assessment in read-only mode. If you have questions or feedback, please contact the assigned teacher.
        </div>
        <div class="d-flex gap-2 mb-4">
            <button type="button" class="btn btn-outline-secondary btn-sm" disabled title="Acknowledgement tracking can be enabled by an admin.">
                <i class="fas fa-check me-1"></i>Mark as Acknowledged
            </button>
        </div>
        {% endif %}
    </div>

    <div class="col-lg-4">
        <div class="card mb-4">
            <div class="card-header">Child</div>
            <div class="card-body">
                <p class="mb-1"><strong>Name:</strong> {{ child.first_name }} {{ child.last_name }}</p>
                <p class="mb-1"><strong>Parent:</strong> {{ child.parent.get_full_name|default:child.parent.username }}</p>
                {% if child.teacher %}<p class="mb-1"><strong>Teacher:</strong> {{ child.teacher.get_full_name|default:child.teacher.username }}</p>{% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}


