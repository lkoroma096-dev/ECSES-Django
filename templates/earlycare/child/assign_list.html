{% extends 'base.html' %}

{% block title %}Assign Children - ECSES{% endblock %}

{% block content %}
<div class="row mb-4">
  <div class="col-12 d-flex justify-content-between align-items-center">
    <h1><i class="fas fa-user-check me-2"></i>Assign Children to Teachers</h1>
    <a href="?unassigned=1" class="btn btn-outline-primary">Show Unassigned Only</a>
  </div>
  <div class="col-12">
    {% if recent_assignments %}
    <div class="alert alert-success d-flex align-items-center" role="alert">
      <i class="fas fa-check-circle me-2"></i>
      <div>
        <strong>Recent assignments:</strong>
        <ul class="mb-0">
          {% for ra in recent_assignments %}
          <li>{{ ra.child_name }} â†’ {{ ra.teacher }}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
    {% endif %}
    <div class="card">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table align-middle">
            <thead>
              <tr>
                <th>Child</th>
                <th>Parent</th>
                <th>Current Teacher</th>
                <th style="width: 340px;">Assign/Reassign</th>
                <th style="width: 220px;">Assign Parent</th>
              </tr>
            </thead>
            <tbody>
              {% for c in children %}
              <tr>
                <td><a href="{% url 'earlycare:child_detail' c.id %}">{{ c.first_name }} {{ c.last_name }}</a></td>
                <td>{{ c.parent.get_full_name|default:c.parent.username }}</td>
                <td>{% if c.teacher %}{{ c.teacher.get_full_name|default:c.teacher.username }}{% else %}<span class="text-muted">Unassigned</span>{% endif %}</td>
                <td>
                  <form method="post" class="d-flex gap-2">
                    {% csrf_token %}
                    <input type="hidden" name="child_id" value="{{ c.id }}">
                    <select name="teacher_id" class="form-select">
                      {% for t in teachers %}
                      <option value="{{ t.id }}" {% if c.teacher and c.teacher.id == t.id %}selected{% endif %}>{{ t.get_full_name|default:t.username }}</option>
                      {% endfor %}
                    </select>
                    <button type="submit" class="btn btn-primary">Assign</button>
                    <a href="{% url 'earlycare:assign_teacher' c.id %}" class="btn btn-outline-secondary">Open</a>
                  </form>
                </td>
                <td>
                  <a href="{% url 'earlycare:assign_parent' c.id %}" class="btn btn-outline-primary">Assign Parent</a>
                </td>
              </tr>
              {% empty %}
              <tr><td colspan="4" class="text-center text-muted py-4">No children found.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}


